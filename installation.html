<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Solar Installation | AI SolarTech Labs</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
  body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #c9d1d9; }
  .solar-gradient { background-image: linear-gradient(to right, #f59e0b, #eab308); }
  .card { transition: transform 0.3s, box-shadow 0.3s; background-color: #161b22; border: 1px solid #30363d; }
  .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(245, 158, 11, 0.2); }
  .input-field { width: 100%; padding: 0.5rem 1rem; border-radius: 0.5rem; background-color: #1f242b; border: 1px solid #30363d; color: #c9d1d9; }
  .input-field:focus { outline: none; border-color: #f59e0b; box-shadow: 0 0 0 2px #f59e0b33; }
  #install-map { height: 300px; border-radius: 0.5rem; border: 1px solid #4b5563; margin-bottom: 10px;}
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "YOUR_FIREBASE_API_KEY",
    authDomain: "YOUR_FIREBASE_PROJECT.firebaseapp.com",
    projectId: "YOUR_FIREBASE_PROJECT_ID",
    storageBucket: "YOUR_FIREBASE_PROJECT.appspot.com",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  window.signInUser = async () => { try { await signInWithPopup(auth, provider); } catch(err){console.error(err); alert("Sign-in failed."); }};
  window.signOutUser = async () => { try { await signOut(auth); } catch(err){console.error(err); alert("Sign-out failed."); }};

  auth.onAuthStateChanged(user => {
    const authUI = document.getElementById("auth-ui-container");
    const submitBtn = document.getElementById("install-submit-btn");
    const authWarning = document.getElementById("auth-warning");
    if(user){
      authUI.innerHTML = `<div class="flex items-center space-x-2">
        <img src="${user.photoURL}" class="w-8 h-8 rounded-full border border-gray-500">
        <span class="text-sm font-medium">${user.displayName}</span>
        <button onclick="signOutUser()" class="text-xs px-2 py-1 bg-gray-700 rounded hover:bg-gray-600">Sign Out</button>
      </div>`;
      submitBtn.disabled=false;
      authWarning.classList.add("hidden");
    } else {
      authUI.innerHTML = `<button onclick="signInUser()" class="px-3 py-1 rounded bg-amber-500 hover:bg-amber-600 text-gray-900 font-semibold text-sm">Sign In with Google</button>`;
      submitBtn.disabled=true;
      authWarning.classList.remove("hidden");
    }
  });
</script>
</head>
<body>
<header class="bg-gray-900/50 backdrop-blur-sm sticky top-0 z-50 shadow-lg border-b border-gray-700">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
    <h1 class="text-2xl font-extrabold text-white">
      <a href="index.html" class="solar-gradient bg-clip-text text-transparent">AI SolarTech</a> Labs
    </h1>
    <div class="flex items-center space-x-4">
      <nav class="hidden md:flex space-x-6">
        <a href="index.html" class="hover:text-amber-400 font-semibold text-white">Home</a>
        <a href="detection.html" class="hover:text-amber-400">Detection</a>
        <a href="design.html" class="hover:text-amber-400">Design Assist</a>
        <a href="installation.html" class="hover:text-amber-400 font-semibold">Installation</a>
        <a href="repair.html" class="hover:text-amber-400">Repair</a>
        <a href="login.html" class="hover:text-amber-400">Login</a>
      </nav>
      <div id="auth-ui-container" class="ml-3 text-sm"></div>
    </div>
  </div>
</header>

<section class="py-16 bg-[#161b22] border-t border-gray-700">
  <div class="max-w-5xl mx-auto px-4 text-center">
    <h2 class="text-4xl font-bold text-white mb-4 flex items-center justify-center">
      <i data-lucide="tool" class="w-8 h-8 mr-3 text-amber-500"></i>
      Installation Management
    </h2>
    <p class="text-gray-400 text-lg mb-8">
      Record and manage solar panel installations efficiently. Select location, add details, and submit installation info.
    </p>

    <div class="bg-gray-800 p-6 rounded-xl shadow-xl border border-gray-700">
      <div id="install-map"></div>

      <div class="grid grid-cols-2 gap-3 mt-4">
        <input type="text" id="customer-name" placeholder="Customer Name" class="input-field">
        <input type="text" id="customer-address" placeholder="Address" class="input-field">
      </div>
      <div class="grid grid-cols-2 gap-3 mt-3">
        <input type="number" id="panel-qty" placeholder="Panels Quantity" class="input-field">
        <input type="date" id="install-date" class="input-field">
      </div>

      <button id="install-submit-btn" class="mt-4 w-full py-3 rounded-lg text-gray-900 solar-gradient font-semibold hover:opacity-90 transition" disabled>
        Submit Installation
      </button>

      <p id="auth-warning" class="text-red-400 mt-4 text-sm">Please Sign In to submit installation data.</p>
    </div>
  </div>
</section>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>lucide.createIcons();</script>

<script>
  // Map setup
  let installMap = L.map('install-map').setView([26.91, 75.79], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(installMap);
  let marker = L.marker([26.91, 75.79], { draggable: true }).addTo(installMap);

  // Handle installation submit
  document.getElementById('install-submit-btn').addEventListener('click', () => {
    const name = document.getElementById('customer-name').value;
    const address = document.getElementById('customer-address').value;
    const qty = document.getElementById('panel-qty').value;
    const date = document.getElementById('install-date').value;
    if(!name || !address || !qty || !date) { alert("Please fill all fields"); return; }

    const data = {
      customerName: name,
      address: address,
      panelQuantity: qty,
      installDate: date,
      location: marker.getLatLng()
    };
    console.log("Installation Data:", data);
    alert("Installation record submitted!");
  });
</script>
</body>
</html>
